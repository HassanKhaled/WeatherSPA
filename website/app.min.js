const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],socialLinks=[{href:"https://www.linkedin.com/in/hassankhaledabdelhady/",icons:["fab","fa-linkedin","fa-2x"]},{href:"https://github.com/HassanKhaled",icons:["fab","fa-github-square","fa-2x"]},{href:"https://twitter.com/hassan_k_a",icons:["fab","fa-twitter-square","fa-2x"]},{href:"https://facebook.com/hassan.khaled.1414",icons:["fab","fa-facebook-square","fa-2x"]}],projects=[{href:"https://github.com/HassanKhaled/WeatherSPA",text:"This Project"},{href:"https://github.com/HassanKhaled/tvGuide",text:"Tv Guide App "}],apis=[{href:"https://openweathermap.org/",text:"Open Weather Maps"},{href:"https://openlayers.org/",text:"Open Layers"},{href:"https://www.countryflags.com/en/",text:"Country Flags"}],stack=[{href:"https://www.w3schools.com/html/",text:"HTML"},{href:"https://www.w3schools.com/js/",text:"JavaScript"},{href:"https://www.w3schools.com/css/",text:"Css"}],cert=[{href:"https://confirm.udacity.com/KKMLTGA4",text:"Web Development Professional"}],languages=[{value:"&lang=ar",text:"Arabic"},{value:"&lang=de",text:"German"},{value:"&lang=en",text:"English"},{value:"&lang=fr",text:"French"},{value:"&lang=it",text:"Italian"},{value:"&lang=af",text:"Afrikaans"},{value:"&lang=al",text:"Albanian"},{value:"&lang=az",text:"Azerbaijani"},{value:"&lang=bg",text:"Bulgarian"},{value:"&lang=ca",text:"Catalan"},{value:"&lang=cz",text:"Czech"},{value:"&lang=da",text:"Danish"},{value:"&lang=el",text:"Greek"},{value:"&lang=eu",text:"Basque"},{value:"&lang=fa",text:"Persian (Farsi)"},{value:"&lang=fi",text:"Finnish"},{value:"&lang=gl",text:"Galician"},{value:"&lang=he",text:"Hebrew"},{value:"&lang=hi",text:"Hindi"},{value:"&lang=hr",text:"Croatian"},{value:"&lang=hu",text:"Hungarian"},{value:"&lang=id",text:"Indonesian"},{value:"&lang=ja",text:"Japanese"},{value:"&lang=kr",text:"Korean"},{value:"&lang=la",text:"Latvian"},{value:"&lang=it",text:"Lithuanian"},{value:"&lang=mk",text:"Macedonian"},{value:"&lang=no",text:"Norwegian"},{value:"&lang=nl",text:"Dutch"},{value:"&lang=pl",text:"Polish"},{value:"&lang=pt",text:"Portuguese"},{value:"&lang=pt_br",text:"Portuguese (Brazil)"},{value:"&lang=ro",text:"Romanian"},{value:"&lang=ru",text:"Russian"},{value:"&lang=sv",text:"Swedish"},{value:"&lang=sk",text:"Slovak"},{value:"&lang=sl",text:"Slovenian"},{value:"&lang=sp",text:"Spanish"},{value:"&lang=sr",text:"Serbian"},{value:"&lang=th",text:"Thai"},{value:"&lang=tr",text:"Turkish"},{value:"&lang=ua",text:"Ukrainian"},{value:"&lang=vi",text:"Vietnamese"},{value:"&lang=zh_cn",text:"Chinese Simplified"},{value:"&lang=zh_tw",text:"Chinese Traditional"},{value:"&lang=zu",text:"Zulu"}],days=[{value:1,text:"1 Day"},{value:2,text:"2 Days"},{value:3,text:"3 Days"},{value:4,text:"4 Days"},{value:5,text:"5 Days"}],requests=[{value:1,text:"Current"},{value:2,text:"Daily"},{value:3,text:"Hourly"},{value:4,text:"Mintly"}],links=[{href:"index.html",text:"Current"}],baseApiUrl="https://api.openweathermap.org/data/2.5/weather",baseOneCallUrl="https://api.openweathermap.org/data/2.5/onecall",baseOneCallTimeMachineUrl="https://api.openweathermap.org/data/2.5/onecall/timemachine";let coord="";const apiKey=select("#api"),apiKeyString="",navigation=document.querySelector("#collapsibleNavbar"),languageSelect=select("#lang"),requestSelect=select("#request"),agoSelect=select("#ago"),flag=select("#flag"),weather=select("#weather"),rise=select("#rise"),down=select("#down"),description=select("#des"),getButton=select("#get"),dailyList=select("#daily"),hourlyList=select("#hourly"),miutlyList=select("#miutly"),saveButton=select("#save"),retrieveButton=select("#ret"),deleteButton=select("#del"),fillButton=select("#fill"),zipInput=select("#zip"),cityInput=select("#city"),lonInput=select("#lon"),latInput=select("#lat"),date=select("#date"),time=select("#time"),temp=select("#temp"),cityIdInput=select("#cityId"),unitSelect=select("#unit"),visisablity=select("#vis");function select(query){return document.querySelector(query)}setTheme=theme=>{let x=document.getElementById("bulb");"light"===theme?(x.classList.remove("fas"),x.classList.add("far"),x.title="light on"):(x.classList.remove("far"),x.classList.add("fas"),x.title="light off"),localStorage.setItem("theme",theme),document.documentElement.className=theme},allTemperatures=(obj,unit)=>`Day:${obj.day+unit}\n \n    Evening:${obj.eve+unit} Morning:${obj.morn+unit} Night:${obj.night+unit} Max:${obj.max+unit} Min:${obj.min+unit}`,extractObjectDataFromResponseData=item=>({dateTime:item.dt,sunRise:item.sunrise,sunSet:item.sunset,temperature:item.temp,allData:function(unit){return[`${getDateFromSeconds(this.dateTime)}`,`${allTemperatures(this.temperature,unit.value)}`]}}),extractObjectFromMinuteData=item=>({min:item.dt,rain:item.precipitation,allData:function(){return[`${getTimeFromSeconds(this.min)}`,`${this.rain}`]}}),extractObjectFromHourData=item=>({hour:item.dt,cloud:item.clouds,feels:item.feels_like,humidity:item.humidity,pressure:item.pressure,temperature:item.temp,visibility:item.visibility,windSpeed:item.wind_speed,windDegree:item.wind_deg,main:item.weather[0].main,sub:item.weather[0].description,icon:item.weather[0].icon,allData:function(unit){return[`${getTimeFromSeconds(this.hour)}`,`${this.temperature} ${unit}`,`${this.feels} ${unit}`,`${this.humidity}`,`${this.pressure}`,`${this.visibility}`,`${this.windSpeed}`,`${this.windDegree}`,`${this.main}`,`${this.sub}`,`${this.icon}`]}}),createListItemFromObject=object=>{let listItem=document.createElement("li"),dateTimeDiv;document.createElement("div").textContent=object.dateTime},toggleTheme=()=>{"light"===localStorage.getItem("theme")?setTheme("dark"):setTheme("light")},RetrieveTheme=()=>{const theme=localStorage.getItem("theme");setTheme(theme)},checkApiKeyIsSuppliedInCode=()=>{{const x=document.querySelector(".form-inline");x.style.display="block"}},setActiveClassForNavBarFromUrl=()=>{const link=getlastUrlFromCompleteUrl(window.location.pathname),items=document.querySelectorAll(".nav-item");for(item of items)getlastUrlFromCompleteUrl(item.children[0].href)===link&&item.children[0].classList.add("active")},getlastUrlFromCompleteUrl=url=>url.split("/")[url.split("/").length-1],fillSelect=(target,list)=>{for(item of list){let x=document.createElement("option");x.setAttribute("value",item.value),x.innerHTML=item.text,target.appendChild(x)}},saveDataToLocalStorage=(key,data)=>{"String"===checkType(data)?localStorage.setItem(key,data):localStorage.setItem(key,JSON.stringify(data))},getDataFromLocalStorage=key=>JSON.parse(localStorage.getItem(key)),removeDataFromLocalStorage=key=>{localStorage.removeItem(key)},fillFooterLinks=(id,list,tag,cls)=>{let htmlElement=document.getElementById(id),fragment=new documentFragment;for(item of list){let innerHTMLElement=document.createElement(tag);innerHTMLElement.classList.add(cls);let tempA=document.createElement("a");tempA.setAttribute("href",item.href),tempA.innerHTML=item.text,innerHTMLElement.appendChild(tempA),fragment.appendChild(innerHTMLElement)}htmlElement.appendChild(fragment)},start=()=>{RetrieveTheme(),setActiveClassForNavBarFromUrl(),fillSelect(languageSelect,languages),fillSelect(requestSelect,requests),checkApiKeyIsSuppliedInCode(),fillSelect(agoSelect,days),fillFooterLinks("projects",projects,"li","list-group-item"),fillFooterLinks("apis",apis,"li","list-group-item"),fillFooterLinks("stack",stack,"li","list-group-item"),fillFooterLinks("cert",cert,"li","list-group-item"),apiKey.value=getDataFromLocalStorage("api"),getButton.disabled=!0},start(),changeDivInnerHTML=(ele,text)=>{ele.innerHTML=`${text}`},getCountryFlageByCountryCodeAndStyle=(imageElement,code,style)=>{imageElement.src=`https://www.countryflags.io/${code}/${style}/64.png`},drawOpenLayersMapOnPage=coord=>{try{map=new OpenLayers.Map("mapdiv"),map.addLayer(new OpenLayers.Layer.OSM);var lonLat=new OpenLayers.LonLat(coord.lon,coord.lat).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject()),zoom=16,markers=new OpenLayers.Layer.Markers("Markers");map.addLayer(markers),markers.addMarker(new OpenLayers.Marker(lonLat)),map.setCenter(lonLat,16)}catch(error){console.error(error),showToastWithTitleAndMessageWithDelay("Error",error,3e3)}},intilizeMap=coord=>{let x=document.getElementById("mapdiv").children.length;if(0===x)drawOpenLayersMapOnPage(coord);else if(1===x){let temp=document.getElementById("mapdiv");temp.removeChild(temp.children[0]),drawOpenLayersMapOnPage(coord)}},getDateFromSeconds=seconds=>{let x,t;return`${new Date(1e3*seconds).toUTCString().slice(0,16)}`},getTimeFromSeconds=seconds=>{let x,t;return`${new Date(1e3*seconds).toUTCString().slice(15,25)}`},fullZipUrl=zip=>`${baseApiUrl}?zip=${zip},us&appid=${text(apiKey)}`,fullCityUrl=city=>`${baseApiUrl}?q=${city}&appid=${text(apiKey)}`,fullLatLonUrl=(lat,lon)=>`${baseApiUrl}?lat=${lat}&lon=${lon}&appid=${text(apiKey)}`,fullOneCallApiUrl=(lat,lon)=>`${baseOneCallUrl}?lat=${lat}&lon=${lon}&appid=${text(apiKey)}`,getTimeOfPreviousDays=day=>{let x=new Date;return console.log(x.getTime()),x.setDate(x.getDate()-parseInt(day)),console.log(x.getTime()),Math.round(x.getTime()/1e3)},fullOneCallApiTimeMachineUrl=(lat,lon,ago)=>`${baseOneCallTimeMachineUrl}?lat=${lat}&lon=${lon}&dt=${getTimeOfPreviousDays(ago)}&appid=${text(apiKey)}`,fullCityIdUrl=id=>`${baseApiUrl}?id=${id}&appid=${text(apiKey)}`,getIconById=id=>`http://openweathermap.org/img/wn/${id}.png`,changeTitle=text=>{const title=select("title");title.innerHTML=text},log=(title,msg)=>{console.log(title,msg)},checkInputFields=()=>{if(""!==text(zipInput))return!0},text=ele=>ele.value,innerHTML=ele=>ele.innerHTML,changeFavIconById=id=>{select("link").setAttribute("href",getIconById(id))},currentDate=()=>{const now=new Date;return`${now.getDate()}\\${now.getMonth()+1}\\${now.getFullYear()}`},getCurrentMonthName=()=>{const now=new Date;return`${months[now.getMonth()]}`},getCurrentDay=()=>{const now=new Date;return`${now.getDate()}`},showHiddenContentDivById=id=>{select("#"+id).style.display="block"},currentTime=()=>{const now=new Date;return`${now.getHours()}:${now.getMinutes()+1}:${now.getSeconds()}`},changeInenerHTMLContentById=(content,id)=>{document.getElementById(id).innerHTML=content},getDegreeUnitFromUnit=()=>{switch(unitSelect.value){case"&units=metric":return" &#176;&#8451";case"&units=imperial":return" &#176;&#8457;";default:return" &#176;&#8490;"}},setTimeInDivById=(target,t)=>{let x=new Date(t),period=getAmOrPm(x.getHours());changeDivInnerHTML(target,`${checkDigits(x.getHours())}:${checkDigits(x.getMinutes())}:${checkDigits(x.getSeconds())} ${period}`)},getAmOrPm=hour=>hour>=12?"PM":"AM",checkDigits=digit=>digit<10?"0"+digit:digit,checkType=data=>typeof data,showToastWithTitleAndMessageWithDelay=(title,message,delay)=>{document.getElementsByTagName("strong")[0].textContent=title,document.getElementsByClassName("toast-body")[0].textContent=message,document.getElementsByClassName("toast")[0].setAttribute("data-delay",delay),$(document).ready((function(){$(".toast").toast({animation:!0}),$(".toast").toast("show")}))},setUnitOfInnerHTML=unit=>{const x=document.querySelectorAll(".holder");for(item of x)item.innerHTML=" "+unit},amOrPmFromString=time=>{let period="";const hour=time.split(":")[0];return period=parseInt(hour)>=12?"PM":"AM",`${time} ${period}`},createNewSpanFromStyleContent=(style,content)=>{let span=document.createElement("span");return span.classList.add("badge"),span.classList.add(style),span.classList.add("badge-pill"),span.innerHTML=content,span},createNewSpanFromStyleContentWithIcon=(style,content,clases)=>{let span=document.createElement("span");span.classList.add("badge"),span.classList.add(style),span.classList.add("badge-pill"),span.innerHTML=content;let i=document.createElement("i");return i.classList.add(clases[0]),i.classList.add(clases[1]),span.appendChild(i),span},createWeatherImageFromIconId=id=>{let x=document.createElement("img");return x.classList.add("rounded"),x.src=getIconById(id),x},createListItem=()=>document.createElement("li"),appendChildToListItem=(li,ele)=>{li.appendChild(ele)},appendMintlyDataTo=(ele,data)=>{for(minute of data){let res=extractObjectFromMinuteData(minute),li=createListItem();li.classList.add("list-group-item"),li.classList.add("list-group-item-dark");let min=createNewSpanFromStyleContent("badge-dark",amOrPmFromString(res.allData()[0].slice(2))),rain=createNewSpanFromStyleContentWithIcon("badge-dark",res.allData()[1]+" &#13212; ",["fas","fa-cloud-rain"]);li.appendChild(min),li.appendChild(rain),ele.appendChild(li)}},appendHourlyDataTo=(ele,data)=>{for(hour of data){const res=extractObjectFromHourData(hour);let li=document.createElement("li"),time=createNewSpanFromStyleContent("badge-dark",amOrPmFromString(res.allData(unit)[0].slice(2))),temp=createNewSpanFromStyleContent("badge-secondary","Temperature :"+res.temperature+" "+unit),feels=createNewSpanFromStyleContent("badge-secondary","Feels Like :"+res.feels+" "+unit),pressure=createNewSpanFromStyleContentWithIcon("badge-secondary","Pressure :"+res.pressure,["fas","fa-thermometer-full"]),humidity=createNewSpanFromStyleContentWithIcon("badge-secondary","Humidity :"+res.humidity,["fas","fa-tint"]),windSpeed=createNewSpanFromStyleContent("badge-secondary","Wind Speed :"+res.windSpeed+" &#13223;"),windDegree=createNewSpanFromStyleContentWithIcon("badge-secondary","Wind Directon :"+res.windDegree+"&deg;",["far","fa-compass"]),img=createWeatherImageFromIconId(res.icon);li.appendChild(time),li.appendChild(temp),li.appendChild(feels),li.appendChild(pressure),li.appendChild(humidity),li.appendChild(windSpeed),li.appendChild(windDegree),li.appendChild(img),li.appendChild(createNewSpanFromStyleContent("badge-dark",res.main+", "+res.sub)),li.classList.add("list-group-item"),li.classList.add("list-group-item-dark"),ele.appendChild(li)}},appendDailyDataTo=(ele,data)=>{for(day of data){let res=extractObjectDataFromResponseData(day),li=document.createElement("li"),span=document.createElement("span");span.classList.add("badge"),span.classList.add("badge-dark"),span.classList.add("badge-pill"),span.innerHTML=res.allData(unit.value)[0],li.appendChild(span);let text=document.createElement("span");text.innerHTML=res.allData(unit)[1],li.appendChild(text),li.classList.add("list-group-item"),li.classList.add("list-group-item-dark"),dailyList.appendChild(li)}},appendCurretData=data=>{let unit=getDegreeUnitFromUnit();weather.src=getIconById(data.current.weather[0].icon),document.querySelector("#temp").innerHTML=data.current.temp+" "+unit,document.querySelector("#like").innerHTML=data.current.feels_like+" "+unit,document.querySelector("#wind").innerHTML=data.current.wind_speed+" &#13223;",document.querySelector("#dir").innerHTML=data.current.wind_deg+"&deg;",document.querySelector("#hum").innerHTML=data.current.humidity,document.querySelector("#pre").innerHTML=data.current.pressure,document.querySelector("#min").innerHTML=data.current.dew_point+" "+unit,document.querySelector("#max").innerHTML=data.current.clouds+" &percnt;",changeInenerHTMLContentById(data.current.visibility+" &#13214;","vis"),changeInenerHTMLContentById(data.current.uvi,"uvi"),changeDivInnerHTML(description,data.current.weather[0].description),appendUnitandIntilizeMap(unit,coord)},appendUnitandIntilizeMap=(unit,coord)=>{setUnitOfInnerHTML(unit),setTimeout(intilizeMap,1e3,coord)},openCollapseWithIndex=index=>{let x=document.getElementsByClassName("collapse");for(item of x)item.classList.remove("show");x[index].classList.add("show")},returnCardIndexes=index=>{const all=document.getElementsByClassName("card");return all[index-1]},hideAllCards=()=>{const cards=document.getElementsByClassName("card");for(card of cards)card.hidden=!0},showCardByIndex=index=>{let temp=document.getElementsByClassName("card")[index-1];1===temp?(returnCardIndexes(temp),card.hidden=!1):2===temp?(returnCardIndexes(temp),card.hidden=!1):3===temp?(returnCardIndexes(temp),card.hidden=!1):4===temp&&(returnCardIndexes(temp),card.hidden=!1)},getWeatherDataFromOpenWeartherApiOneCall=async url=>{let completeUrl=url+unitSelect.value+languageSelect.value;const response=await fetch(completeUrl);try{console.log("one call api");const data=await response.json();document.getElementById("dateTime").innerText=getDateFromSeconds(data.current.dt),""!==agoSelect.value&&(requestSelect.value=1);let value=requestSelect.value,index=parseInt(value)-1;console.log(requestSelect.value),"1"===value?(openCollapseWithIndex(index),appendCurretData(data)):"2"===value?(openCollapseWithIndex(index),appendDailyDataTo(dailyList,data.daily)):"3"===value?(openCollapseWithIndex(index),appendHourlyDataTo(hourlyList,data.hourly)):"4"===value&&(openCollapseWithIndex(index),appendMintlyDataTo(miutlyList,data.minutely))}catch(error){console.error(error),showToastWithTitleAndMessageWithDelay("Error",error,3e3)}},getWeatherDataFromOpenWeartherApi=async url=>{let completeUrl=url+unitSelect.value+languageSelect.value;const response=await fetch(completeUrl);try{const data=await response.json();if(200===data.cod){let unit=getDegreeUnitFromUnit();console.log(data),getCountryFlageByCountryCodeAndStyle(flag,data.sys.country,"flat");let current=data.main;coord=data.coord,""!==agoSelect.value?getWeatherDataFromOpenWeartherApiOneCall(fullOneCallApiTimeMachineUrl(coord.lat,coord.lon,agoSelect.value)):getWeatherDataFromOpenWeartherApiOneCall(fullOneCallApiUrl(coord.lat,coord.lon))}}catch(error){console.error(error),showToastWithTitleAndMessageWithDelay("Error",error,3e3)}},error=()=>{showToastWithTitleAndMessageWithDelay("Error","Unable to retrieve your location",3e3)},success=position=>{latInput.value=position.coords.latitude,lonInput.value=position.coords.longitude},getButton.addEventListener("click",()=>{if(""!==apiKey.value&&""!==requestSelect.value){let x=document.querySelectorAll('input[type="text"]');for(i of x){if("zip"===i.id&&""!==i.value){getWeatherDataFromOpenWeartherApi(fullZipUrl(text(zipInput)));break}if("city"===i.id&&""!==i.value){getWeatherDataFromOpenWeartherApi(fullCityUrl(text(cityInput)));break}if("cityId"===i.id&&""!==i.value){getWeatherDataFromOpenWeartherApi(fullCityIdUrl(text(cityIdInput)));break}if("lon"===i.id&&""!==i.value){getWeatherDataFromOpenWeartherApi(fullLatLonUrl(text(latInput),text(lonInput)));break}}}else showToastWithTitleAndMessageWithDelay("Error","Make Sure the api Key is provided",3e3)}),fillButton.addEventListener("click",e=>{e.preventDefault(),""!==apiKey.value?navigator.geolocation.getCurrentPosition(success,error):showToastWithTitleAndMessageWithDelay("Error","Make Sure you have your Api key",3e3)}),saveButton.addEventListener("click",e=>{e.preventDefault(),saveDataToLocalStorage("api",apiKey.value)}),deleteButton.addEventListener("click",e=>{e.preventDefault(),apiKey.value="",removeDataFromLocalStorage("api")}),retrieveButton.addEventListener("click",e=>{e.preventDefault(),apiKey.value=getDataFromLocalStorage("api")}),document.getElementById("light").addEventListener("click",e=>{e.preventDefault(),toggleTheme()}),document.getElementById("setting").addEventListener("click",e=>{e.preventDefault()}),requestSelect.addEventListener("change",e=>{let temp=e.target.value,card=returnCardIndexes(temp);hideAllCards(),""!==temp&&(getButton.disabled=!1,card.hidden=!1),showCardByIndex(temp)});